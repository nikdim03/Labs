%macro myUniversalMacro 2
    mov bx, %1
    call %2
%endmacro

%macro getLen 2
    call %2
    mov cx, 7
    mov bh, 0
    mov si, 0
    m3:
        cmp byte[si], %1
        jz notHash
        inc bx
        notHash:
        inc si
    loop m3
%endmacro

%macro addSym 4
    call %3
    call %2
    mov si, bx
    mov byte[si], '.'
    dec si
    mov byte[si], %4
%endmacro

%macro addSym32 4
    call %3
    call %2
    mov si, bx
    cmp bx, 32
    jns less32
    mov byte[si], '.'
    dec si
    mov byte[si], %4
    less32:
%endmacro

%macro addSymStart32 4
    call %3
    call %2
    mov si, bx
    cmp bx, 32
    jns less322
    mov byte[si], '.'
    dec si
    mov byte[si], '#'
    mov cx, bx
    m4:
        dec si
        mov dh, byte[si]
        mov byte[si], dh
    loop m4
    mov si, 0
    mov byte[si], %4
    less322:
%endmacro

%macro addSymGiv32 5
    call %3
    call %2
    mov si, bx
    cmp bx, 32
    jns less3222
    mov byte[si], '.'
    dec si
    mov byte[si], '#'
    sub bx, %5
    mov cx, bx
    m5:
        dec si
        mov dh, byte[si]
        mov byte[si], dh
    loop m5
    mov si, %5
    mov byte[si], %4
    less3222:
%endmacro

%macro findSym 7
    call %3
    call %2
    mov dx, bx
    call %6
    mov cx, dx
    mov si, cx
    m6:
        cmp byte[si], %7
        jnz isSym
        mov dx, si
        isSym:
        dec si
    loop m6
%endmacro



;===[ Начало сегмента кода ]=========================================================================
MYCODE: segment .code
org 100h; Обязательная директива для COM-файлов
START:;---[ Точка старта ]---------------------------------------------------------------------------



;call task1
;call task2
;call task3
;call task4
;call task5
;call task6
;call task7
;call task8
call task9



;---[ Стандартное завершение программы ]-------------------------------------------------------------
    mov AX, 4C00h
    int 21h




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task1:
    mov ah, 00h
    mov si, 00
    mov cx, 3
    m1:
        mov byte [SI], ah
        add si, bx
    loop m1
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task2:
    myUniversalMacro 20h, task1
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task3:
    mov cx, 6
    mov si, 6
    mov byte [SI], '.'
    dec si
    m2:
        mov byte [SI], '#'
        dec si
    loop m2
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task4:
    getLen 00h, task3
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task5:
    addSym 00h, task4, task3, '@'
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task6:
    addSym32 00h, task4, task3, '@'
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task7:
    addSymStart32 00h, task4, task3, '@'
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task8:
    addSymGiv32 00h, task4, task3, '@', 03h
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------




;---[ Начало подпрограммы ]--------------------------------------------------------------------------
task9:
    findSym 00h, task4, task3, '@', 03h, task8, '@'
ret
;---[ Конец подпрограммы ]---------------------------------------------------------------------------
